# 计算机网络-网络层

网络层关注的是如何将分组从源端沿着网络路径送达到目标端。

在网络层/传输层的接口面上，网络层向传输层提供服务。对于设计自由度的争议比较大，集中在网络层应该提供面向连接的服务还是提供无连接的服务。

提供面向无连的服务的支持者认为，路由器的任务仅仅是传送分组，不用在所别的事情。另一阵营则认为，子网应该提供可靠的、面向连接的服务，在他们的观点中，服务质量是最重要的因素，如果子网中没有连接，那么实现服务质量是很困难的，特别是对于诸如语音和视频这类的实时流量。

如果提供的服务是无连接的服务，那么所有的分组都被独立的传送到子网中，并且独立于路由，不需要提前建立任何的辅助设施。这样的的上下文环境称为数据报，这样的子网被称为数据报子网。如果使用的是面向连接的服务时，那么在发送数据分组之前，必须先建立起一条从源机器到目标路由器之间的路径。这个连接称为虚电路，且子网称为虚电路子网。这两个子网对比如下：

|      比较项      |    数据报子网     |   虚电路子网   |
|------------------|------------------|----------------|
| 建立电路 | 不需要 | 需要 |
| 地址信息 | 每个分组包含完整的源地址和目的地址 | 每个分组包含一个很短的虚电路号 |
| 状态信息 | 路由器不包含任何的有关连接的状态信息 | 每个虚电路都要求路由器为每一个连接建立表项 |
| 路由     | 每个分组都被独立的路由 | 当虚电路建立的时候选择路径，所有的分组都沿着这条路径 |
| 路由器失效的影响 | 没有影响，除非在崩溃中分组丢失 | 所有经过此失效路由的虚电路都将中止 |
| 服务质量 | 很难实现 | 如果有足够的资源可以提前分配给每一个虚电路，则很容易实现 |
| 拥塞控制 | 很难实现 | 如果有足够的资源可以提前分配给每一个虚电路，则容易实现 |

## 路由算法

如果子网内部使用了数据报，那么路由器在每次分组到达时都会重新选择路径。如果使用了虚电路，那么当虚电路建立时，才需要建立路由。一个好的路由算法应当具备：正确性、简单性、健壮性、公平性和最优性。
```
最优化原则：如果路由器J是在从路由器I到K的最优路径上，那么，从J到K的最优路劲也必定是沿着同样的路由路径。
```

### 最短路径路由
建立一个子网图，图中每一个节点代表一台路由器，每条弧代表一条通信线路。为了在一对给定的路由器之间选择一条路由路径，路由算法只需要在图中找到这对节点之间的最短路劲即可。

衡量路径长度可以是距离、带宽、平均流量、通信开销、平均队列长度、延迟等。可以使用加权函数使用多种准则选择最短路径。

具体算法思想详见[数据结构-图](/DA/DA-graph.md)Dijkstra算法。

## 扩散法

每一个新进来的分组将被发送到除了它进来的那条路线之外的每一条输出线路上。扩散法会产生大量的重复分组，除非采取一种办法来抑制扩散过程，否则扩散法将会产生无限多的分组。一个稍微实际点的算法是选择性扩散。在这个算法中，路由器并不是将每个新进来的分组都输出到每一条线路上，而只是输出到那些方位大概正确的路线上。

## 距离矢量路由
每个路由器维护一张表，表中列出了当前已知到每个目标的最佳距离，以及所使用的线路。通过在邻居间相互交换信息，路由器不断地更新他们内部的表。

