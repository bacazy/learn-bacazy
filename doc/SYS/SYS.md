# 操作系统

从资源管理的角度操作系统的功能主要有：
* 处理机分配
* 存储器管理
* 设备管理
* 软件资源管理：为用户提供一种简便的、统一的存取和管理信息的方法，并要解决信息的共享、数据的存取控制和保密等问题。

内核特征：
* 并发：在计算机中同时存在多个程序，在宏观上，这些程序时同时在执行，在微观上，任何时刻只有一个程序在执行，这些程序在CPU上轮流执行
* 共享：操作系统与多个用户程序共同使用操作系统中的资源，操作系统对资源进行合理分配和使用。
* 虚拟：
* 异步

## 操作系统类型：
* 实时操作系统：计算机对于用户请求能足够快的进行处理，并做出反应。一般要求毫秒级、微秒级。常用于实时控制和实时信息处理系统，例如防空系统、情报检索和查询系统等。其特点在于对外部的信号必须能及时响应，要求搞得可靠性和安全性，效率则置于次位，不要求很强的会话能力。
* 个人操作系统：windows等
* 网络操作系统：网络上各种计算机方便有效的共享网络资源，为网络用户提供所需的各种服务的软件和通信协议的集合。
* 分布式系统：时网络操作系统的更高级的形式，保持了网络操作的系统的全部功能。它是一个资源进一步共享，资源时共享分布的，但对于用来说是透明的，另外，处于分布式系统的多个主机是出于平等的地位。分布式系统各个计算机相互通讯，无主从关系，而网络操纵系统有主从关系。分布式系统资源时所有用户共享，而网络操作系统只是有限的共享，分布式系统中若干个计算机可相互协作共同完成一项任务。
* 嵌入式系统：在各种设备、装置或系统中，完成特定功能夫人软硬件系统。

操作系统的主要功能：硬件抽象和协调管理


## 启动、中断、异常和系统调用


## 内核模式与用户模式
为了便面用户应用程序访问或者修改关键的操作系统数据，Windows使用了两种处理器访问模式：用户模式和内核模式。用户应用程序运行在用户模式下，而操作系统代码运行在内核模式下。内核模式是指：它允许访问所有的系统内存和所有的CPU指令。处理器让操作系统软件有更高的特级权级，从而为操作系统设计者提供了一个良好的保护基础，确保一个行为不正常的应用程序不会破坏系统整体的稳定性。

内核模式的操作系统和设备驱动程序共享一个虚拟地址空间。虚拟内存中的每一个页面都被标记了处理器必须在什么模式下才可读写该页面。系统空间中的页面只能在内核模式下才能访问，而用户地址空间中的左右页面在用户模式下都是可以访问的。

| 内核模式                         |                   用户模式 |
|--------------------------|------------------------------|
| 操作系统程序执行 | 用户程序执行 |
| 可以使用全部指令 | 禁止使用特权指令 |
| 可以使用全部系统资源 | 只允许使用自己的存储区域 |

```
从用户模式到内核模式的转换本身不会影响线程的调度。
```
特权指令包含：
* 允许和禁用中断
* 在进程之间切换处理机
* 存取用于内存保护的寄存器
* 执行输入和输出的操作
* 停止一个中央处理机的工作
用户模式向内核模式转换：
* 用户程序使用操作系统的服务（系统调用）
* 发生一次中断
* 用户程序中产生了一个错误的状态
* 在用户程序中企图执行一条特权指令
从内核模式转回用户模式使用一条指令实现，这条指令也是特权指令。一般情况下是中断返回指令。

## 中断技术
中断是指某个事件发生时，系统中止现行的程序的运行，引出事件处理程序进行处理，处理完毕后返回断点，继续执行。
引入中断技术的目的有：
* 解决主机与外设的并行工作问题
* 提高可靠性
* 实现多机联系
* 实现实时控制
中断按功能分类：
1. 输入输出中断：I/O出书结束或者出错中断
1. 外中断：时钟中断、通信中断、操作员控制中断等
1. 机器故障中断：电源故障、主存取指令出错等
1. 程序性中断（软中断）：浮点溢出、用户态使用内核指令等
1. 访管中断：对操作系统提出某种需求时发出的中断

### 保护现场和恢复现场
现场：中断那一刻能保证程序能继续运行的有关信息，主要包括，后继指令所在主存的单元号，程序运行所处的状态、指令执行情况、程序执行的中间结果。
当中断发生时，把现场信息保存至主存中，之一过程称为保护现场。程序重新运行之前，需要将该程序的现场信息恢复，这一过程称为恢复现场。